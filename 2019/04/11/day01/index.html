<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="网络爬虫框架Webmagicv1.0.13_201811 By BoBo 课程目标：  说出网络爬虫的作用 能够使用WebMagic爬取网络数据 完成十次方文章爬虫微服务 完成十次方用户数据的爬取  1 谈谈网络爬虫1.1 什么是网络爬虫在大数据时代，信息的采集是一项重要的工作，而互联网中的数据是海量的，如果单纯靠人力进行信息采集，不仅低效繁琐，搜集的成本也会提高。如何自动高效地获取互联网中我们感">
<meta property="og:type" content="article">
<meta property="og:title" content="Viviand0sin&#39;s Blog">
<meta property="og:url" content="https://viviand0sin.github.io/2019/04/11/day01/index.html">
<meta property="og:site_name" content="Viviand0sin&#39;s Blog">
<meta property="og:description" content="网络爬虫框架Webmagicv1.0.13_201811 By BoBo 课程目标：  说出网络爬虫的作用 能够使用WebMagic爬取网络数据 完成十次方文章爬虫微服务 完成十次方用户数据的爬取  1 谈谈网络爬虫1.1 什么是网络爬虫在大数据时代，信息的采集是一项重要的工作，而互联网中的数据是海量的，如果单纯靠人力进行信息采集，不仅低效繁琐，搜集的成本也会提高。如何自动高效地获取互联网中我们感">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://viviand0sin.github.io/2019/04/11/day01/day01.assets/1539913052800.png">
<meta property="og:image" content="https://viviand0sin.github.io/2019/04/11/day01/day01.assets/1539913552999.png">
<meta property="og:image" content="https://viviand0sin.github.io/2019/04/11/day01/day01.assets/1540088133057.png">
<meta property="og:image" content="https://viviand0sin.github.io/2019/04/11/day01/day01.assets/1540089373279.png">
<meta property="og:updated_time" content="2019-04-11T09:02:05.870Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Viviand0sin&#39;s Blog">
<meta name="twitter:description" content="网络爬虫框架Webmagicv1.0.13_201811 By BoBo 课程目标：  说出网络爬虫的作用 能够使用WebMagic爬取网络数据 完成十次方文章爬虫微服务 完成十次方用户数据的爬取  1 谈谈网络爬虫1.1 什么是网络爬虫在大数据时代，信息的采集是一项重要的工作，而互联网中的数据是海量的，如果单纯靠人力进行信息采集，不仅低效繁琐，搜集的成本也会提高。如何自动高效地获取互联网中我们感">
<meta name="twitter:image" content="https://viviand0sin.github.io/2019/04/11/day01/day01.assets/1539913052800.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://viviand0sin.github.io/2019/04/11/day01/">





  <title> | Viviand0sin's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Viviand0sin's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">─━╋..み生命是幻觉.可是我需要你在. Vivian.み..╋━─</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://viviand0sin.github.io/2019/04/11/day01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Viviand0sin">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Viviand0sin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline"></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-11T17:00:31+08:00">
                2019-04-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="网络爬虫框架Webmagic"><a href="#网络爬虫框架Webmagic" class="headerlink" title="网络爬虫框架Webmagic"></a>网络爬虫框架Webmagic</h1><p>v1.0.13_201811 By BoBo</p>
<p>课程目标：</p>
<ul>
<li>说出网络爬虫的作用</li>
<li>能够使用WebMagic爬取网络数据</li>
<li>完成十次方文章爬虫微服务</li>
<li>完成十次方用户数据的爬取</li>
</ul>
<h1 id="1-谈谈网络爬虫"><a href="#1-谈谈网络爬虫" class="headerlink" title="1 谈谈网络爬虫"></a>1 谈谈网络爬虫</h1><h2 id="1-1-什么是网络爬虫"><a href="#1-1-什么是网络爬虫" class="headerlink" title="1.1 什么是网络爬虫"></a>1.1 什么是网络爬虫</h2><p>在大数据时代，信息的采集是一项重要的工作，而互联网中的数据是海量的，如果单纯靠人力进行信息采集，不仅低效繁琐，搜集的成本也会提高。如何自动高效地获取互联网中我们感兴趣的信息并为我们所用是一个重要的问题，而爬虫技术就是为了解决这些问题而生的。</p>
<p>网络爬虫（Web Crawler）也叫做网络机器人，可以代替人们自动地在互联网中进行数据信息的采集与整理。它是一种按照一定的规则，自动地抓取万维网信息的程序或者脚本，可以自动采集所有其能够访问到的页面内容，以获取或更新这些网站的内容和检索方式。</p>
<p>从功能上来讲，爬虫一般分为<strong>数据采集、处理、储存</strong>三个部分。爬虫从一个或若干初始网页的URL开始，获得初始网页上的URL，在抓取网页的过程中，不断从当前页面上抽取新的URL放入队列,直到满足系统的一定停止条件。</p>
<h2 id="1-2-网络爬虫可以做什么"><a href="#1-2-网络爬虫可以做什么" class="headerlink" title="1.2 网络爬虫可以做什么"></a>1.2 网络爬虫可以做什么</h2><p>我们初步认识了网络爬虫，网络爬虫具体可以做什么呢？</p>
<ul>
<li><p>可以实现搜索引擎：从互联网上抓取数据。</p>
</li>
<li><p>大数据时代，可以让我们获取更多的数据源：有针对性抓取大量数据。</p>
</li>
<li><p>快速填充测试和运营数据：抓取样板数据，比如新闻、文章、交友等，可抓取相关网站的数据。</p>
</li>
<li><p>为人工智能提供训练数据集：根据运算的需要抓取数据。</p>
</li>
</ul>
<h2 id="1-3-网络爬虫常用的技术（Java）"><a href="#1-3-网络爬虫常用的技术（Java）" class="headerlink" title="1.3 网络爬虫常用的技术（Java）"></a>1.3 网络爬虫常用的技术（Java）</h2><p>Java技术栈实现的方式主要有两种方式：底层实现和开源框架。</p>
<h3 id="1-3-1-底层实现-HttpClient-Jsoup"><a href="#1-3-1-底层实现-HttpClient-Jsoup" class="headerlink" title="1.3.1 底层实现 HttpClient + Jsoup"></a>1.3.1 底层实现 HttpClient + Jsoup</h3><p>HttpClient 是 Apache Jakarta Common 下的子项目，用来提供高效的、最新的、功能丰富的支持 HTTP 协议的客户端编程工具包，并且它支持 HTTP 协议最新的版本和建议。</p>
<p>HttpClient 已经应用在很多的项目中，比如 Apache Jakarta 上很著名的另外两个开源项目Cactus 和 HTMLUnit 都使用了 HttpClient。更多信息请关注<a href="http://hc.apache.org/" target="_blank" rel="noopener">http://hc.apache.org/</a></p>
<p>jsoup 是一款Java 的HTML解析器，可直接解析某个URL地址、HTML文本内容。它提供了一套非常省力的API，可通过DOM，CSS以及类似于jQuery的操作方法来取出和操作数据。</p>
<h3 id="1-3-2-开源框架-WebMagic"><a href="#1-3-2-开源框架-WebMagic" class="headerlink" title="1.3.2 开源框架 WebMagic"></a>1.3.2 开源框架 WebMagic</h3><p>WebMagic是一个开源的Java爬虫框架，它无须配置、便于二次开发、提供简单灵活的API，只需少量代码即可实现一个爬虫。目标是简化爬虫的开发流程，让开发者专注于逻辑功能的开发。WebMagic的核心非常简单，但是覆盖爬虫的整个流程，也是很好的学习爬虫开发的材料。</p>
<p>官网：<a href="http://webmagic.io/" target="_blank" rel="noopener">http://webmagic.io/</a></p>
<p><img src="day01.assets/1539913052800.png" alt="1539913052800"></p>
<p>WebMagic的主要特性：</p>
<ul>
<li><p>简单的API，可快速上手</p>
<p>核心简单但是涵盖爬虫的全部流程，灵活而强大，也是学习爬虫入门的好材料。</p>
<p>无配置，但是可通过POJO+注解形式实现一个爬虫</p>
</li>
<li><p>模块化的结构，可轻松扩展</p>
<p>完全模块化的设计，强大的可扩展性。</p>
<p>无框架依赖，可以灵活的嵌入到项目中去。</p>
</li>
<li><p>提供多线程和分布式支持</p>
</li>
<li><p>支持爬取js动态渲染的页面。</p>
</li>
</ul>
<h1 id="2-爬虫框架WebMagic"><a href="#2-爬虫框架WebMagic" class="headerlink" title="2 爬虫框架WebMagic"></a>2 爬虫框架WebMagic</h1><h2 id="2-1-架构解析"><a href="#2-1-架构解析" class="headerlink" title="2.1 架构解析"></a>2.1 架构解析</h2><p>WebMagic项目代码分为核心和扩展两部分：</p>
<ul>
<li><p>核心部分(webmagic-core)是一个精简的、模块化的爬虫实现，而扩展部分则包括一些便利的、实用性的功能。</p>
</li>
<li><p>扩展部分(webmagic-extension)提供一些便捷的功能，例如注解模式编写爬虫等。同时内置了一些常用的组件，便于爬虫开发。</p>
</li>
</ul>
<p>WebMagic的设计目标是尽量的模块化，并体现爬虫的功能特点。这部分提供非常简单、灵活的API，在基本不改变开发模式的情况下，编写一个爬虫。</p>
<p>WebMagic的结构分为Downloader、PageProcessor、Scheduler、Pipeline四大组件，并由Spider将它们彼此组织起来。这四大组件对应爬虫生命周期中的下载、处理、管理和持久化等功能。而Spider则将这几个组件组织起来，让它们可以互相交互，流程化的执行，可以认为Spider是一个大的容器，它也是WebMagic逻辑的核心。</p>
<p><img src="day01.assets/1539913552999.png" alt="1539913552999"></p>
<p>四大组件：</p>
<ul>
<li>Downloader</li>
</ul>
<p>Downloader负责从互联网上下载页面，以便后续处理。WebMagic默认使用了Apache HttpClient作为下载工具。</p>
<ul>
<li>PageProcessor</li>
</ul>
<p>PageProcessor负责解析页面，抽取有用信息，以及发现新的链接。WebMagic使用Jsoup作为HTML解析工具，并基于其开发了解析XPath的工具Xsoup。</p>
<p>在这四个组件中，PageProcessor对于每个站点每个页面都不一样，是需要使用者定制的部分。</p>
<ul>
<li>Scheduler</li>
</ul>
<p>Scheduler负责管理待抓取的URL，以及一些去重的工作。WebMagic默认提供了JDK的内存队列来管理URL，并用集合来进行去重。也支持使用Redis进行分布式管理。</p>
<ul>
<li>Pipeline</li>
</ul>
<p>Pipeline负责抽取结果的处理，包括计算、持久化到文件、数据库等。WebMagic默认提供了“输出到控制台”和“保存到文件”两种结果处理方案。</p>
<h2 id="2-2-PageProcessor"><a href="#2-2-PageProcessor" class="headerlink" title="2.2 PageProcessor"></a>2.2 PageProcessor</h2><p>需求：编写爬虫程序，爬取csdn中博客的内容</p>
<h3 id="2-2-1-爬取页面全部内容"><a href="#2-2-1-爬取页面全部内容" class="headerlink" title="2.2.1 爬取页面全部内容"></a>2.2.1 爬取页面全部内容</h3><p><a href="https://blog.csdn.net" target="_blank" rel="noopener">https://blog.csdn.net</a></p>
<p><a href="https://blog.csdn.net/nav/ai" target="_blank" rel="noopener">https://blog.csdn.net/nav/ai</a></p>
<p>（1）创建Java的Maven工程，引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.itcast.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>webmagicdemo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>us.codecraft<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>webmagic-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>us.codecraft<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>webmagic-extension<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（2）编写类实现网页内容的爬取</p>
<p>cn.itcast.demo.MyProcessor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Page;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Site;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Spider;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.processor.PageProcessor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 页面处理类（爬取类）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProcessor</span> <span class="keyword">implements</span> <span class="title">PageProcessor</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 页面处理相关方法,处理逻辑（解析）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page 抓取的页面对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//原封不动的打印页面html源码</span></span><br><span class="line">        System.out.println(page.getHtml().toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * （要抓取的）站点（URLs）配置,获取站点抓取的配置信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Site <span class="title">getSite</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//配置站点信息</span></span><br><span class="line">        <span class="keyword">return</span> Site.me()</span><br><span class="line">                <span class="comment">//设置（如果读取url失败）重试的次数</span></span><br><span class="line">                .setRetryTimes(<span class="number">3</span>)</span><br><span class="line">                <span class="comment">//设置间隔时间（单位：毫秒），默认是5秒，会影响到抓取的频率</span></span><br><span class="line">                .setSleepTime(<span class="number">1000</span>)</span><br><span class="line">                ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//入口方法，用来测试</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//使用自定义的处理对象创建蜘蛛对象</span></span><br><span class="line">        Spider.create(</span><br><span class="line">                <span class="comment">//自定义的处理对象</span></span><br><span class="line">                <span class="keyword">new</span> MyProcessor())</span><br><span class="line">                <span class="comment">//添加你要抓取的URL（种子URL）</span></span><br><span class="line">                .addUrl(<span class="string">"https://blog.csdn.net/"</span>)</span><br><span class="line">                <span class="comment">//运行抓取</span></span><br><span class="line">                .run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spider是爬虫启动的入口。在启动爬虫之前，我们需要使用一个PageProcessor创建一个Spider对象，然后使用run()进行启动。</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>create(PageProcessor)</td>
<td>创建Spider</td>
<td>Spider.create(new GithubRepoProcessor())</td>
</tr>
<tr>
<td>addUrl(String…)</td>
<td>添加初始的URL</td>
<td>spider.addUrl(“<a href="http://webmagic.io/docs/&quot;" target="_blank" rel="noopener">http://webmagic.io/docs/&quot;</a>)</td>
</tr>
<tr>
<td>thread(n)</td>
<td>开启n个线程</td>
<td>spider.thread(5)</td>
</tr>
<tr>
<td>run()</td>
<td>启动，会阻塞当前线程执行</td>
<td>spider.run()</td>
</tr>
<tr>
<td>start()/runAsync()</td>
<td>异步启动，当前线程继续执行</td>
<td>spider.start()</td>
</tr>
<tr>
<td>stop()</td>
<td>stop()</td>
<td>spider.stop()</td>
</tr>
<tr>
<td>addPipeline(Pipeline)</td>
<td>添加一个Pipeline，一个Spider可以有多个Pipeline</td>
<td>spider .addPipeline(new ConsolePipeline())</td>
</tr>
<tr>
<td>setScheduler(Scheduler)</td>
<td>设置Scheduler，一个Spider只能有个一个Scheduler</td>
<td>spider.setScheduler(new RedisScheduler())</td>
</tr>
<tr>
<td>setDownloader(Downloader)</td>
<td>设置Downloader，一个Spider只能有个一个Downloader</td>
<td>spider .setDownloader( new SeleniumDownloader())</td>
</tr>
<tr>
<td>get(String)</td>
<td>同步调用，并直接取得结果</td>
<td>ResultItems result = spider.get(“<a href="http://webmagic.io/docs/&quot;" target="_blank" rel="noopener">http://webmagic.io/docs/&quot;</a>)</td>
</tr>
<tr>
<td>getAll(String…)</td>
<td>同步调用，并直接取得一堆结果</td>
<td>List results = spider.getAll(“<a href="http://webmagic.io/docs/&quot;,&quot;http://webmagic.io/xxx&quot;" target="_blank" rel="noopener">http://webmagic.io/docs/&quot;,&quot;http://webmagic.io/xxx&quot;</a>)</td>
</tr>
</tbody>
</table>
<p>同时Spider的其他组件（Downloader、Scheduler、Pipeline）都可以通过set方法来进行设置。</p>
<p>Page代表了从Downloader下载到的一个页面——可能是HTML，也可能是JSON或者其他文本格式的内容。Page是WebMagic抽取过程的核心对象，它提供一些方法可供抽取、结果保存等。</p>
<p>Site用于定义站点本身的一些配置信息，例如编码、HTTP头、超时时间、重试策略等、代理等，都可以通过设置Site对象来进行配置。</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>setCharset(String)</td>
<td>设置编码</td>
<td>site.setCharset(“utf-8”)</td>
</tr>
<tr>
<td>setUserAgent(String)</td>
<td>设置UserAgent</td>
<td>site.setUserAgent(“Spider”)</td>
</tr>
<tr>
<td>setTimeOut(int)</td>
<td>设置超时时间， 单位是毫秒</td>
<td>site.setTimeOut(3000)</td>
</tr>
<tr>
<td>setRetryTimes(int)</td>
<td>设置重试次数</td>
<td>site.setRetryTimes(3)</td>
</tr>
<tr>
<td>setCycleRetryTimes(int)</td>
<td>设置循环重试次数</td>
<td>site.setCycleRetryTimes(3)</td>
</tr>
<tr>
<td>addCookie(String,String)</td>
<td>添加一条cookie</td>
<td>site.addCookie(“dotcomt_user”,”code4craft”)</td>
</tr>
<tr>
<td>setDomain(String)</td>
<td>设置域名，需设置域名后，addCookie才可生效</td>
<td>site.setDomain(“github.com”)</td>
</tr>
<tr>
<td>addHeader(String,String)</td>
<td>添加一条addHeader</td>
<td>site.addHeader(“Referer”,”<a href="https://github.com&quot;" target="_blank" rel="noopener">https://github.com&quot;</a>)</td>
</tr>
<tr>
<td>setHttpProxy(HttpHost)</td>
<td>设置Http代理</td>
<td>site.setHttpProxy(newHttpHost(“127.0.0.1”,8080))</td>
</tr>
</tbody>
</table>
<h3 id="2-2-2-爬取指定内容（XPath）"><a href="#2-2-2-爬取指定内容（XPath）" class="headerlink" title="2.2.2 爬取指定内容（XPath）"></a>2.2.2 爬取指定内容（XPath）</h3><p>如果我们想爬取网页中部分的内容，需要指定xpath。</p>
<p>XPath，即为XML路径语言（XML Path Language），它是一种用来确定XML文档中某部分位置的语言。XPath 使用路径表达式来选取 XML 文档中的节点或者节点集。这些路径表达式和我们在常规的电脑文件系统中看到的表达式非常相似。 语法详见附录A。</p>
<p>我们通过指定xpath来抓取网页的部分内容，比如要抓取CSDN首页的左边菜单的链接“人工智能”，可以编写如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2.抓取页面的指定的位置节点的内容</span></span><br><span class="line"><span class="comment">//需求：抓取“人工智能”超级链接节点:&lt;a href="/nav/ai"&gt;人工智能&lt;/a&gt;</span></span><br><span class="line">System.out.println(page.getHtml()</span><br><span class="line">        .xpath(<span class="string">"//*[@id=\"nav\"]/div/div/ul/li[5]/a"</span>)</span><br><span class="line">        .toString());</span><br><span class="line"><span class="comment">//需求：抓取“人工智能”超级链接中的文本内容</span></span><br><span class="line">System.out.println(page.getHtml()</span><br><span class="line">        .xpath(<span class="string">"//*[@id=\"nav\"]/div/div/ul/li[5]/a/text()"</span>)</span><br><span class="line">        .toString());</span><br></pre></td></tr></table></figure>
<p>以上代码的含义：</p>
<p>1）id为nav的节点下的div节点下的div节点下的ul下的第5个li节点下的a节点。</p>
<p>2）id为nav的节点下的div节点下的div节点下的ul下的第5个li节点下的a节点的文本内容。</p>
<p>【提示】</p>
<p>可以使用浏览器自带的工具来直接获取某节点的XPath。</p>
<p>测试：运行结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;/nav/ai&quot;&gt;人工智能&lt;/a&gt;</span><br><span class="line">人工智能</span><br></pre></td></tr></table></figure>
<h3 id="2-2-3-添加目标地址抓取所有链接"><a href="#2-2-3-添加目标地址抓取所有链接" class="headerlink" title="2.2.3 添加目标地址抓取所有链接"></a>2.2.3 添加目标地址抓取所有链接</h3><p>需求：实际环境下，需要爬取很多页面的信息，一般是通过种子页面，顺着超链接，向下抓取页面并寻找内容。</p>
<p>我们可以通过添加目标地址，从种子页面爬取到更多的页面。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3添加目标地址抓取所有链接(包含种子页面的所有连接的页面)</span></span><br><span class="line">        <span class="comment">//3.1:添加目标地址-添加种子页面的全部链接地址</span></span><br><span class="line">        page.addTargetRequests(</span><br><span class="line">                <span class="comment">//获取当前页面代码</span></span><br><span class="line">                page.getHtml()</span><br><span class="line">                        <span class="comment">//获取该页面的所有链接</span></span><br><span class="line">                        .links()</span><br><span class="line">                        <span class="comment">//获取链接的url字符串集合</span></span><br><span class="line">                        .all());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.2:抓取“人工智能”超级链接中的文本内容</span></span><br><span class="line">        System.out.println(page.getHtml()</span><br><span class="line">                .xpath(<span class="string">"//*[@id=\"nav\"]/div/div/ul/li[5]/a/text()"</span>)</span><br><span class="line">                .toString());</span><br></pre></td></tr></table></figure>
<p>运行后发现好多地址都出现在控制台。</p>
<h3 id="2-2-4-目标地址正则匹配并只抓取指定内容"><a href="#2-2-4-目标地址正则匹配并只抓取指定内容" class="headerlink" title="2.2.4 目标地址正则匹配并只抓取指定内容"></a>2.2.4 目标地址正则匹配并只抓取指定内容</h3><p>需求：通常我们只需要抓取某一类内容的地址，比如只提取博客的文章详细页内容的页面，并且只提取打印标题。</p>
<p>首先要分析博客的文章详细页的地址，找出链接的规则，写出正则表达式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/bit_kaki/article/details/83111683</span><br><span class="line">https://blog.csdn.net/GISShiXiSheng/article/details/83070227</span><br></pre></td></tr></table></figure>
<p>代码实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//4. 目标地址正则匹配</span></span><br><span class="line">        <span class="comment">//需求：只抓取具体文章的页面，爬取只提取博客的文章详细页内容，并提取标题。</span></span><br><span class="line">        <span class="comment">//4.1:添加目标地址-使用正则表达式过滤需要的地址</span></span><br><span class="line">        page.addTargetRequests(</span><br><span class="line">                <span class="comment">//获取当前页面代码</span></span><br><span class="line">                page.getHtml()</span><br><span class="line">                        <span class="comment">//获取该页面的所有链接&lt;a&gt;</span></span><br><span class="line">                        .links()</span><br><span class="line">                        <span class="comment">//使用正则表达式，过滤掉不需要的链接，只抓取需要的链接</span></span><br><span class="line">                        <span class="comment">//例如：真正文章的连接：https://blog.csdn.net/bit_kaki/article/details/83111683</span></span><br><span class="line">                        .regex(<span class="string">"https://blog.csdn.net/[a-z 0-9 - _]+/article/details/[0-9]&#123;8&#125;"</span>)</span><br><span class="line">                        <span class="comment">//.regex("https://blog.csdn.net/[a-zA-Z][a-zA-Z_0-9]&#123;5,19&#125;/article/details/\\d&#123;8&#125;")</span></span><br><span class="line">                        <span class="comment">//获取链接的url字符串集合</span></span><br><span class="line">                        .all());</span><br><span class="line">        <span class="comment">//4.2:抓取文章的标题</span></span><br><span class="line">        System.out.println(page.getHtml()</span><br><span class="line">                .xpath(<span class="string">"//*[@id=\"mainBox\"]/main/div[1]/div/div/div[1]/h1/text()"</span>)</span><br><span class="line">                .toString());</span><br></pre></td></tr></table></figure>
<p>运行后发现好多地址都出现在控制台</p>
<h2 id="2-3-Pipeline"><a href="#2-3-Pipeline" class="headerlink" title="2.3 Pipeline"></a>2.3 Pipeline</h2><p>抓取的结果输出到哪里？</p>
<h3 id="2-3-1-ConsolePipeline-控制台输出"><a href="#2-3-1-ConsolePipeline-控制台输出" class="headerlink" title="2.3.1 ConsolePipeline 控制台输出"></a>2.3.1 ConsolePipeline 控制台输出</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Page;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Site;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Spider;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.pipeline.ConsolePipeline;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.processor.PageProcessor;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理类（爬取类）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProcessor</span> <span class="keyword">implements</span> <span class="title">PageProcessor</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理逻辑（解析）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page 抓取的页面对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//=================使用pipeline输出的测试</span></span><br><span class="line">        <span class="comment">//只提取博客的文章详细页内容，并提取标题</span></span><br><span class="line">        page.addTargetRequests(page.getHtml().links()</span><br><span class="line">                .regex(<span class="string">"https://blog.csdn.net/[a-z 0-9 - _]+/article/details/[0-9]&#123;8&#125;"</span>)</span><br><span class="line">                .all());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//获取博客文章的标题</span></span><br><span class="line">        String title=page.getHtml()</span><br><span class="line">                .xpath(<span class="string">"//*[@id=\"mainBox\"]/main/div[1]/div/div/div[1]/h1/text()"</span>)</span><br><span class="line">                .toString();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//将结果放入ResultItems对象中</span></span><br><span class="line">        page.putField(<span class="string">"title"</span>,title);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取站点抓取的配置信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Site <span class="title">getSite</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//配置站点信息</span></span><br><span class="line">        <span class="keyword">return</span> Site.me()</span><br><span class="line">                <span class="comment">//间隔时间（单位：毫秒），默认是5秒</span></span><br><span class="line">                .setSleepTime(<span class="number">100</span>)</span><br><span class="line">                <span class="comment">//重试次数</span></span><br><span class="line">                .setRetryTimes(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//入口方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//使用自定义的处理对象创建蜘蛛对象</span></span><br><span class="line">        Spider.create(<span class="keyword">new</span> MyProcessor())</span><br><span class="line">                <span class="comment">//添加要抓取的URL</span></span><br><span class="line">                .addUrl(<span class="string">"https://www.csdn.net/"</span>)</span><br><span class="line">                <span class="comment">//添加管道的控制台输出</span></span><br><span class="line">                .addPipeline(<span class="keyword">new</span> ConsolePipeline())</span><br><span class="line">                <span class="comment">//运行抓取</span></span><br><span class="line">                .run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>提示：不能漏掉toString()方法。</p>
<h3 id="2-3-2-FilePipeline-文件保存"><a href="#2-3-2-FilePipeline-文件保存" class="headerlink" title="2.3.2 FilePipeline 文件保存"></a>2.3.2 FilePipeline 文件保存</h3><p>需求：将抓取的结果保存到文件中</p>
<p>代码实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用自定义的处理对象创建蜘蛛对象</span></span><br><span class="line">        Spider.create(<span class="keyword">new</span> MyProcessor())</span><br><span class="line">                <span class="comment">//添加要抓取的URL</span></span><br><span class="line">                .addUrl(<span class="string">"https://www.csdn.net/"</span>)</span><br><span class="line">                <span class="comment">//添加管道的控制台输出</span></span><br><span class="line">                .addPipeline(<span class="keyword">new</span> ConsolePipeline())</span><br><span class="line">                <span class="comment">//html文件的方式输出</span></span><br><span class="line">                .addPipeline(<span class="keyword">new</span> FilePipeline(<span class="string">"d:/shhm031/data/html"</span>))</span><br><span class="line">                <span class="comment">//运行抓取</span></span><br><span class="line">                .run();</span><br></pre></td></tr></table></figure>
<p>在文件输出的目录中随意打开一个文件，内容参考如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url:	https://blog.csdn.net/Code_My_Dream/article/details/65442030</span><br><span class="line">title:	平均年薪23万！为什么却很少见程序员炫富?</span><br></pre></td></tr></table></figure>
<h3 id="2-3-3-JsonFilePipeline"><a href="#2-3-3-JsonFilePipeline" class="headerlink" title="2.3.3 JsonFilePipeline"></a>2.3.3 JsonFilePipeline</h3><p>需求：将抓取的结果输出到json格式的文件中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用自定义的处理对象创建蜘蛛对象</span></span><br><span class="line">        Spider.create(<span class="keyword">new</span> MyProcessor())</span><br><span class="line">                <span class="comment">//添加要抓取的URL</span></span><br><span class="line">                .addUrl(<span class="string">"https://www.csdn.net/"</span>)</span><br><span class="line">                <span class="comment">//添加管道的控制台输出</span></span><br><span class="line">                .addPipeline(<span class="keyword">new</span> ConsolePipeline())</span><br><span class="line">                <span class="comment">//html文件的方式输出</span></span><br><span class="line">                .addPipeline(<span class="keyword">new</span> FilePipeline(<span class="string">"D:\\shhm042\\data\\html"</span>))</span><br><span class="line">                <span class="comment">//json文件的方式输出</span></span><br><span class="line">                .addPipeline(<span class="keyword">new</span> JsonFilePipeline(<span class="string">"D:\\shhm042\\data\\json"</span>))</span><br><span class="line">                <span class="comment">//运行抓取</span></span><br><span class="line">                .run();</span><br></pre></td></tr></table></figure>
<p>在json文件输出的目录中随意打开一个json文件，内容参考如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;title&quot;:&quot;都是工作2年，你刚月薪过万，他却已拿到40万年薪&quot;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-4-Pipeline的定制"><a href="#2-3-4-Pipeline的定制" class="headerlink" title="2.3.4 Pipeline的定制"></a>2.3.4 Pipeline的定制</h3><p>如果以上Pipeline都不能满足你的需要，你可以定制Pipeline</p>
<p>（1）创建类MyPipeline实现接口Pipeline</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.ResultItems;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Task;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.pipeline.Pipeline;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.selector.Selectable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义pipeline</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyPipeline</span> <span class="keyword">implements</span> <span class="title">Pipeline</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resultItems 处理器处理后的数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> task</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(ResultItems resultItems, Task task)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//结果对象中获取某字段属性</span></span><br><span class="line">        String title=resultItems.get(<span class="string">"title"</span>);</span><br><span class="line">        <span class="comment">//打印</span></span><br><span class="line">        System.out.println(<span class="string">"---------我的定制的 title:"</span>+title);</span><br><span class="line">        <span class="comment">//如果放入的字段的值没有toString，则使用该类型</span></span><br><span class="line"><span class="comment">//        Selectable titleSelectable =resultItems.get("title");</span></span><br><span class="line"><span class="comment">//        System.out.println("我的定制的2 title:"+titleSelectable.toString());</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（2）修改main方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//入口方法，用来测试</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//使用自定义的处理对象创建蜘蛛对象</span></span><br><span class="line">    Spider.create(</span><br><span class="line">            <span class="comment">//自定义的处理对象</span></span><br><span class="line">            <span class="keyword">new</span> MyProcessor())</span><br><span class="line">            <span class="comment">//添加你要抓取的URL（种子URL）</span></span><br><span class="line">            .addUrl(<span class="string">"https://blog.csdn.net/"</span>)</span><br><span class="line">            <span class="comment">//添加管道输出</span></span><br><span class="line">            <span class="comment">//1）控制台输出</span></span><br><span class="line">            .addPipeline(<span class="keyword">new</span> ConsolePipeline())</span><br><span class="line">            <span class="comment">//2)html文件的方式输出</span></span><br><span class="line">            .addPipeline(<span class="keyword">new</span> FilePipeline(<span class="string">"d:/shhm041/data/html"</span>))</span><br><span class="line">            <span class="comment">//3)json文件的方式输出</span></span><br><span class="line">            .addPipeline(<span class="keyword">new</span> JsonFilePipeline(<span class="string">"d:/shhm041/data/json"</span>))</span><br><span class="line">            <span class="comment">//4)定制化输出</span></span><br><span class="line">            .addPipeline(<span class="keyword">new</span> MyPipeline())</span><br><span class="line">            <span class="comment">//运行抓取</span></span><br><span class="line">            .run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-4-Scheduler"><a href="#2-4-Scheduler" class="headerlink" title="2.4 Scheduler"></a>2.4 Scheduler</h2><p>我们刚才完成的功能，每次运行可能会爬取重复的页面，这样做是没有任何意义的。</p>
<p>Scheduler(URL管理) 最基本的功能是实现对已经爬取的URL进行标示。可以实现URL的增量去重。</p>
<p>目前scheduler主要有三种实现方式：</p>
<p>1）内存队列 QueueScheduler</p>
<p>2）文件队列 FileCacheQueueScheduler</p>
<p>3)  Redis队列 RedisScheduler</p>
<h3 id="2-4-1-内存队列"><a href="#2-4-1-内存队列" class="headerlink" title="2.4.1 内存队列"></a>2.4.1 内存队列</h3><p>使用setScheduler来设置Scheduler</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//入口方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//使用自定义的处理对象创建蜘蛛对象</span></span><br><span class="line">    Spider.create(<span class="keyword">new</span> MyProcessor())</span><br><span class="line">            <span class="comment">//添加要抓取的URL</span></span><br><span class="line">            .addUrl(<span class="string">"https://www.csdn.net/"</span>)</span><br><span class="line">            <span class="comment">//设置内存队列</span></span><br><span class="line">            .setScheduler(<span class="keyword">new</span> QueueScheduler())</span><br><span class="line">            <span class="comment">//运行抓取</span></span><br><span class="line">            .run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>优点：</p>
<p>效率高。</p>
<p>缺点：</p>
<p>1）时间长了占用大量内存</p>
<p>2）重启程序后队列会丢失</p>
<h3 id="2-4-2-文件缓存队列"><a href="#2-4-2-文件缓存队列" class="headerlink" title="2.4.2 文件缓存队列"></a>2.4.2 文件缓存队列</h3><p>使用文件保存抓取URL，可以在关闭程序并下次启动时，从之前抓取到的URL继续抓取</p>
<p>（1）创建文件夹<code>D:\shhm031\schedulercache</code></p>
<p>（2）修改代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//入口方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//使用自定义的处理对象创建蜘蛛对象</span></span><br><span class="line">        Spider.create(<span class="keyword">new</span> MyProcessor())</span><br><span class="line">                <span class="comment">//添加要抓取的URL</span></span><br><span class="line">                .addUrl(<span class="string">"https://www.csdn.net/"</span>)                </span><br><span class="line"><span class="comment">//                设置内存队列</span></span><br><span class="line"><span class="comment">//                .setScheduler(new QueueScheduler())</span></span><br><span class="line">                <span class="comment">//文件缓存队列</span></span><br><span class="line">                .setScheduler(<span class="keyword">new</span> FileCacheQueueScheduler(<span class="string">"D:\\shhm031\\data\\schedulercache"</span>))</span><br><span class="line">                <span class="comment">//运行抓取</span></span><br><span class="line">                .run();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>运行后文件夹E:\scheduler会产生两个文件blog.csdn.net.urls.txt和blog.csdn.net.cursor.txt</p>
<p><img src="day01.assets/1540088133057.png" alt="1540088133057"></p>
<p>优点：</p>
<p>存放大量队列</p>
<p>可暂停、可继续爬取。</p>
<p>缺点：</p>
<p>效率不高</p>
<p>分布式的情况下队列不能共享。</p>
<h3 id="2-4-3-Redis队列"><a href="#2-4-3-Redis队列" class="headerlink" title="2.4.3 Redis队列"></a>2.4.3 Redis队列</h3><p>使用Redis保存抓取队列，可进行多台机器同时合作抓取</p>
<p>（1）运行redis服务端</p>
<p>（2）修改代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//入口方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//使用自定义的处理对象创建蜘蛛对象</span></span><br><span class="line">        Spider.create(<span class="keyword">new</span> MyProcessor())</span><br><span class="line">                <span class="comment">//添加要抓取的URL</span></span><br><span class="line">                .addUrl(<span class="string">"https://www.csdn.net/"</span>)                </span><br><span class="line"><span class="comment">//                设置内存队列</span></span><br><span class="line"><span class="comment">//                .setScheduler(new QueueScheduler())</span></span><br><span class="line">                <span class="comment">//文件缓存队列</span></span><br><span class="line"><span class="comment">//                .setScheduler(new FileCacheQueueScheduler("D:\\shhm031\\schedulercache"))  </span></span><br><span class="line">                <span class="comment">//Redis缓存队列</span></span><br><span class="line">                .setScheduler(<span class="keyword">new</span> RedisScheduler(<span class="string">"127.0.0.1"</span>))</span><br><span class="line">                <span class="comment">//运行抓取</span></span><br><span class="line">                .run();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="3-十次方文章爬取"><a href="#3-十次方文章爬取" class="headerlink" title="3 十次方文章爬取"></a>3 十次方文章爬取</h1><h2 id="3-1-需求分析"><a href="#3-1-需求分析" class="headerlink" title="3.1 需求分析"></a>3.1 需求分析</h2><p>每日某时间段整从CSDN播客中爬取文档，存入文章数据库中。</p>
<h2 id="3-2-频道设置"><a href="#3-2-频道设置" class="headerlink" title="3.2 频道设置"></a>3.2 频道设置</h2><table>
<thead>
<tr>
<th>频道名称</th>
<th>地址</th>
</tr>
</thead>
<tbody>
<tr>
<td>资讯</td>
<td><a href="https://blog.csdn.net/nav/news" target="_blank" rel="noopener">https://blog.csdn.net/nav/news</a></td>
</tr>
<tr>
<td>人工智能</td>
<td><a href="https://blog.csdn.net/nav/ai" target="_blank" rel="noopener">https://blog.csdn.net/nav/ai</a></td>
</tr>
<tr>
<td>区块链</td>
<td><a href="https://blog.csdn.net/nav/blockchain" target="_blank" rel="noopener">https://blog.csdn.net/nav/blockchain</a></td>
</tr>
<tr>
<td>数据库</td>
<td><a href="https://blog.csdn.net/nav/db" target="_blank" rel="noopener">https://blog.csdn.net/nav/db</a></td>
</tr>
<tr>
<td>前端</td>
<td><a href="https://blog.csdn.net/nav/web" target="_blank" rel="noopener">https://blog.csdn.net/nav/web</a></td>
</tr>
<tr>
<td>编程语言</td>
<td><a href="https://blog.csdn.net/nav/lang" target="_blank" rel="noopener">https://blog.csdn.net/nav/lang</a></td>
</tr>
</tbody>
</table>
<p>手动向数据库tensquare_article的tb_channel表中添加记录</p>
<p><img src="day01.assets/1540089373279.png" alt="1540089373279"></p>
<p>参考脚本：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">SQLyog Ultimate v12.5.1 (64 bit)</span></span><br><span class="line"><span class="comment">MySQL - 5.7.23 : Database - tensquare_article</span></span><br><span class="line"><span class="comment">*********************************************************************</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*!40101 SET NAMES utf8 */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*!40101 SET SQL_MODE=''*/</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */</span>;</span><br><span class="line"><span class="comment">/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */</span>;</span><br><span class="line"><span class="comment">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="comment">/*!32312 IF NOT EXISTS*/</span><span class="string">`tensquare_article`</span> <span class="comment">/*!40100 DEFAULT CHARACTER SET utf8 */</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">USE</span> <span class="string">`tensquare_article`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*Table structure for table `tb_channel` */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_channel`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_channel`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ID'</span>,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'频道名称'</span>,</span><br><span class="line">  <span class="string">`state`</span> <span class="built_in">varchar</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'状态'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">'频道'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*Data for the table `tb_channel` */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> <span class="string">`tb_channel`</span>(<span class="string">`id`</span>,<span class="string">`name`</span>,<span class="string">`state`</span>) <span class="keyword">values</span> </span><br><span class="line">(<span class="string">'ai'</span>,<span class="string">'人工智能'</span>,<span class="string">'1'</span>),</span><br><span class="line">(<span class="string">'blockchain'</span>,<span class="string">'区块链'</span>,<span class="string">'1'</span>),</span><br><span class="line">(<span class="string">'db'</span>,<span class="string">'数据库'</span>,<span class="string">'1'</span>),</span><br><span class="line">(<span class="string">'lang'</span>,<span class="string">'编程语言'</span>,<span class="string">'1'</span>),</span><br><span class="line">(<span class="string">'news'</span>,<span class="string">'资讯'</span>,<span class="string">'1'</span>),</span><br><span class="line">(<span class="string">'web'</span>,<span class="string">'前端'</span>,<span class="string">'1'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span>;</span><br><span class="line"><span class="comment">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */</span>;</span><br><span class="line"><span class="comment">/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */</span>;</span><br><span class="line"><span class="comment">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span>;</span><br></pre></td></tr></table></figure>
<h2 id="3-3-代码编写"><a href="#3-3-代码编写" class="headerlink" title="3.3 代码编写"></a>3.3 代码编写</h2><h3 id="3-3-1-模块搭建"><a href="#3-3-1-模块搭建" class="headerlink" title="3.3.1 模块搭建"></a>3.3.1 模块搭建</h3><p>（1）创建模块tensquare_article_crawler ，引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tensquare_parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.tensquare<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tensquare_article_crawler<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>us.codecraft<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>webmagic-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>us.codecraft<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>webmagic-extension<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.tensquare<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tensquare_common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（2）创建配置文件application.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">9014</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">tensquare-article-crawler</span> <span class="comment">#指定服务名</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    driverClassName:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://192.168.40.128:3306/tensquare_article?characterEncoding=UTF8</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="number">123456</span></span><br><span class="line"><span class="attr">  jpa:</span></span><br><span class="line"><span class="attr">    database:</span> <span class="string">MYSQL</span></span><br><span class="line"><span class="attr">    show-sql:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">#自定义Redis属性</span></span><br><span class="line"><span class="attr">redis:</span></span><br><span class="line"><span class="attr">  host:</span> <span class="number">192.168</span><span class="number">.40</span><span class="number">.128</span></span><br></pre></td></tr></table></figure>
<p>（3）创建启动类</p>
<p>com.tensquare.articlecrawler.ArticleCrawlerApplication</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tensquare.articlecrawler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableScheduling;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.scheduler.RedisScheduler;</span><br><span class="line"><span class="keyword">import</span> utils.IdWorker;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章爬虫微服务启动类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">//开启定时任务注解功能</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticleCrawlerApplication</span> </span>&#123;</span><br><span class="line">    <span class="comment">//入口方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ArticleCrawlerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * id生成器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IdWorker <span class="title">idWorker</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> IdWorker(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//注入Redis主机地址</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;redis.host&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String redis_host;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//定义RedisScheduler的Bean</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisScheduler <span class="title">redisScheduler</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RedisScheduler(redis_host);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（4）实体类及数据访问接口</p>
<p>参见文章微服务。直接拷贝过来，代码略</p>
<h3 id="3-3-2-爬取处理类"><a href="#3-3-2-爬取处理类" class="headerlink" title="3.3.2 爬取处理类"></a>3.3.2 爬取处理类</h3><p>创建文章爬取类ArticleProcessor</p>
<p>com.tensquare.articlecrawler.processor.ArticleProcessor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tensquare.articlecrawler.processor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Page;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Site;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.processor.PageProcessor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章的页面处理类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticleProcessor</span> <span class="keyword">implements</span> <span class="title">PageProcessor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.爬取的请求目标</span></span><br><span class="line">        page.addTargetRequests(page.getHtml().links()</span><br><span class="line">            .regex(<span class="string">"https://blog.csdn.net/[a-z 0-9 - _]+/article/details/[0-9]&#123;8&#125;"</span>)</span><br><span class="line">            .all());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.爬取的内容定位</span></span><br><span class="line">        <span class="comment">//标题</span></span><br><span class="line">        String title= page.getHtml().xpath(<span class="string">"//*[@id=\"mainBox\"]/main/div[1]/div/div/div[1]/h1/text()"</span>).toString();</span><br><span class="line">        <span class="comment">//内容</span></span><br><span class="line">        String content= page.getHtml().xpath(<span class="string">"//*[@id=\"article_content\"]/div[2]"</span>).toString();</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(content))&#123;</span><br><span class="line">            content= page.getHtml().xpath(<span class="string">"//*[@id=\"article_content\"]/div"</span>).toString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//打印获取页面需要的内容(略)</span></span><br><span class="line">        System.out.println(<span class="string">"标题："</span>+title);</span><br><span class="line">        System.out.println(<span class="string">"内容："</span>+content);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.将结果放入resultItems中</span></span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.isEmpty(title) &amp;&amp; !StringUtils.isEmpty(content))&#123;</span><br><span class="line">            <span class="comment">//标题和内容都不为空，则放入resultItems中</span></span><br><span class="line">            page.putField(<span class="string">"title"</span>,title);</span><br><span class="line">            page.putField(<span class="string">"content"</span>,content);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//否则，跳过采集</span></span><br><span class="line">            page.setSkip(<span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Site <span class="title">getSite</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Site.me()</span><br><span class="line">                .setSleepTime(<span class="number">3000</span>)</span><br><span class="line">                .setRetryTimes(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-3-3-入库输出类"><a href="#3-3-3-入库输出类" class="headerlink" title="3.3.3 入库输出类"></a>3.3.3 入库输出类</h3><p>创建文章入库类ArticleDbPipeline ，负责将爬取的数据存入（持久化）数据库</p>
<p>com.tensquare.articlecrawler.pipeline.ArticleDbPipeline </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tensquare.articlecrawler.pipeline;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.tensquare.articlecrawler.dao.ArticleRepository;</span><br><span class="line"><span class="keyword">import</span> com.tensquare.articlecrawler.po.Article;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.ResultItems;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Task;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.pipeline.Pipeline;</span><br><span class="line"><span class="keyword">import</span> utils.IdWorker;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 输出入库类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticleDbPipeline</span> <span class="keyword">implements</span> <span class="title">Pipeline</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注入idWorker</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IdWorker idWorker;</span><br><span class="line">    <span class="comment">//注入dao</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ArticleRepository articleRepository;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//频道ID</span></span><br><span class="line">    <span class="keyword">private</span> String channelId;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setChannelId</span><span class="params">(String channelId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.channelId = channelId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(ResultItems resultItems, Task task)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取需要的数据</span></span><br><span class="line">        String title = resultItems.get(<span class="string">"title"</span>);</span><br><span class="line">        String content= resultItems.get(<span class="string">"content"</span>);</span><br><span class="line">        <span class="comment">//将数据准备存入数据库</span></span><br><span class="line">        Article article=<span class="keyword">new</span> Article();</span><br><span class="line">        article.setId(idWorker.nextId()+<span class="string">""</span>);</span><br><span class="line">        <span class="comment">//标题</span></span><br><span class="line">        article.setTitle(title);</span><br><span class="line">        <span class="comment">//内容</span></span><br><span class="line">        article.setContent(content);</span><br><span class="line">        <span class="comment">//频道id</span></span><br><span class="line">        article.setChannelid(channelId);</span><br><span class="line">        <span class="comment">//保存</span></span><br><span class="line">        articleRepository.save(article);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ReusltItems 相当于一个Map，它保存PageProcessor处理的结果，供Pipeline使用。它的API与Map很类似，值得注意的是它有一个字段 skip ，若设置为true，则不应被Pipeline处理。</p>
<h3 id="3-3-4-任务调度类"><a href="#3-3-4-任务调度类" class="headerlink" title="3.3.4 任务调度类"></a>3.3.4 任务调度类</h3><p>需求：分别爬取不同频道的文章。</p>
<p>创建任务类</p>
<p>com.tensquare.articlecrawler.task.ArticleTask</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tensquare.articlecrawler.task;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.tensquare.articlecrawler.pipeline.ArticleDbPipeline;</span><br><span class="line"><span class="keyword">import</span> com.tensquare.articlecrawler.processor.ArticleProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Spider;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.pipeline.ConsolePipeline;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.scheduler.RedisScheduler;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章调度任务类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticleTask</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注入文章处理对象</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ArticleProcessor articleProcessor;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注入文章的输出入库对象</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ArticleDbPipeline articleDbPipeline;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注入Redis调度队列对象</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisScheduler redisScheduler;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 人工智能任务方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//简单重复方式</span></span><br><span class="line">    <span class="meta">@Scheduled</span>(fixedDelay = <span class="number">60</span>*<span class="number">60</span>*<span class="number">1000</span><span class="comment">//执行间隔，间隔多少毫秒执行一次，间隔1个小时执行一次</span></span><br><span class="line">            ,initialDelay = <span class="number">5</span>*<span class="number">1000</span><span class="comment">//第一次执行前等待多少毫秒，这里是等待5秒</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment">//计划表达式方式</span></span><br><span class="line"><span class="comment">//    @Scheduled(cron = "* * * * * ?")//每秒执行一次</span></span><br><span class="line"><span class="comment">//    @Scheduled(cron = "* * 0/2 * * ?")//每秒执行一次</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">aiTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始爬取AI的文章......"</span>);</span><br><span class="line">        <span class="comment">//频道id</span></span><br><span class="line">        articleDbPipeline.setChannelId(<span class="string">"ai"</span>);</span><br><span class="line">        <span class="comment">//蜘蛛</span></span><br><span class="line">        Spider.create(articleProcessor)</span><br><span class="line">                <span class="comment">//添加种子url-人工智能频道的url</span></span><br><span class="line">                .addUrl(<span class="string">"https://blog.csdn.net/nav/ai"</span>)</span><br><span class="line">                <span class="comment">//添加输出管道到控制台</span></span><br><span class="line">                .addPipeline(<span class="keyword">new</span> ConsolePipeline())</span><br><span class="line">                <span class="comment">//添加输出管道到数据库</span></span><br><span class="line">                .addPipeline(articleDbPipeline)</span><br><span class="line">                <span class="comment">//设置Scheduler</span></span><br><span class="line">                .setScheduler(redisScheduler)</span><br><span class="line">                <span class="comment">//异步执行，效率更高</span></span><br><span class="line">                .start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前端文章任务方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//简单重复方式</span></span><br><span class="line">    <span class="meta">@Scheduled</span>(fixedDelay = <span class="number">60</span>*<span class="number">60</span>*<span class="number">1000</span><span class="comment">//执行间隔，间隔多少毫秒执行一次，间隔1个小时执行一次</span></span><br><span class="line">            ,initialDelay = <span class="number">5</span>*<span class="number">1000</span><span class="comment">//第一次执行前等待多少毫秒，这里是等待5秒</span></span><br><span class="line">    )</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">webTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始爬取前端的文章......"</span>);</span><br><span class="line">        <span class="comment">//频道id</span></span><br><span class="line">        articleDbPipeline.setChannelId(<span class="string">"web"</span>);</span><br><span class="line">        <span class="comment">//蜘蛛</span></span><br><span class="line">        Spider.create(articleProcessor)</span><br><span class="line">                <span class="comment">//添加种子url-人工智能频道的url</span></span><br><span class="line">                .addUrl(<span class="string">"https://blog.csdn.net/nav/web"</span>)</span><br><span class="line">                <span class="comment">//添加输出管道到控制台</span></span><br><span class="line">                .addPipeline(<span class="keyword">new</span> ConsolePipeline())</span><br><span class="line">                <span class="comment">//添加输出管道到数据库</span></span><br><span class="line">                .addPipeline(articleDbPipeline)</span><br><span class="line">                <span class="comment">//设置Scheduler</span></span><br><span class="line">                .setScheduler(redisScheduler)</span><br><span class="line">                <span class="comment">//异步执行，效率更高</span></span><br><span class="line">                .start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据库的任务方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//简单重复方式</span></span><br><span class="line">    <span class="meta">@Scheduled</span>(fixedDelay = <span class="number">60</span>*<span class="number">60</span>*<span class="number">1000</span><span class="comment">//执行间隔，间隔多少毫秒执行一次，间隔1个小时执行一次</span></span><br><span class="line">            ,initialDelay = <span class="number">5</span>*<span class="number">1000</span><span class="comment">//第一次执行前等待多少毫秒，这里是等待5秒</span></span><br><span class="line">    )</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dbTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始爬取数据库的文章......"</span>);</span><br><span class="line">        <span class="comment">//频道id</span></span><br><span class="line">        articleDbPipeline.setChannelId(<span class="string">"db"</span>);</span><br><span class="line">        <span class="comment">//蜘蛛</span></span><br><span class="line">        Spider.create(articleProcessor)</span><br><span class="line">                <span class="comment">//添加种子url-人工智能频道的url</span></span><br><span class="line">                .addUrl(<span class="string">"https://blog.csdn.net/nav/db"</span>)</span><br><span class="line">                <span class="comment">//添加输出管道到控制台</span></span><br><span class="line">                .addPipeline(<span class="keyword">new</span> ConsolePipeline())</span><br><span class="line">                <span class="comment">//添加输出管道到数据库</span></span><br><span class="line">                .addPipeline(articleDbPipeline)</span><br><span class="line">                <span class="comment">//设置Scheduler</span></span><br><span class="line">                .setScheduler(redisScheduler)</span><br><span class="line">                <span class="comment">//异步执行，效率更高</span></span><br><span class="line">                .start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>【了解】</p>
<p>在爬虫抓取的时候，有的文章可能会太长，导致数据库字段存不下。</p>
<table>
<thead>
<tr>
<th>数据类型</th>
<th>最大长度</th>
<th>大小</th>
</tr>
</thead>
<tbody>
<tr>
<td>TINYTEXT</td>
<td>256 bytes</td>
<td></td>
</tr>
<tr>
<td>TEXT</td>
<td>65,535 bytes</td>
<td>~64kb</td>
</tr>
<tr>
<td>MEDIUMTEXT</td>
<td>16,777,215 bytes</td>
<td>~16MB</td>
</tr>
<tr>
<td>LONGTEXT</td>
<td>4,294,967,295 bytes</td>
<td>~4GB</td>
</tr>
</tbody>
</table>
<h1 id="4-十次方用户数据爬取"><a href="#4-十次方用户数据爬取" class="headerlink" title="4 十次方用户数据爬取"></a>4 十次方用户数据爬取</h1><h2 id="4-1-需求分析"><a href="#4-1-需求分析" class="headerlink" title="4.1 需求分析"></a>4.1 需求分析</h2><p>需求：从csdn中爬取用户昵称和头像，存到用户表，头像图片存储到本地。</p>
<h2 id="4-2-代码编写"><a href="#4-2-代码编写" class="headerlink" title="4.2 代码编写"></a>4.2 代码编写</h2><h3 id="4-2-1-模块搭建"><a href="#4-2-1-模块搭建" class="headerlink" title="4.2.1 模块搭建"></a>4.2.1 模块搭建</h3><p>（1）创建工程tensquare_user_crawler。pom.xml引入依赖，可参考文章爬虫微服务。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tensquare_parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.tensquare<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tensquare_user_crawler<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>us.codecraft<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>webmagic-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>us.codecraft<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>webmagic-extension<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.tensquare<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tensquare_common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>（2）创建配置文件application.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">9015</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">tensquare-user-crawler</span> <span class="comment">#指定服务名</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    driverClassName:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://192.168.40.128:3306/tensquare_user?characterEncoding=UTF8</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="number">123456</span></span><br><span class="line"><span class="attr">  jpa:</span></span><br><span class="line"><span class="attr">    database:</span> <span class="string">MYSQL</span></span><br><span class="line"><span class="attr">    show-sql:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">#自定义Redis属性</span></span><br><span class="line"><span class="attr">redis:</span></span><br><span class="line"><span class="attr">  host:</span> <span class="number">192.168</span><span class="number">.40</span><span class="number">.128</span></span><br></pre></td></tr></table></figure>
<p>（3）创建启动类</p>
<p>com.tensquare.usercrawler.UserCrawlerApplication</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tensquare.usercrawler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableScheduling;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.scheduler.RedisScheduler;</span><br><span class="line"><span class="keyword">import</span> utils.IdWorker;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章爬虫微服务启动类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">//开启定时任务注解功能</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserCrawlerApplication</span> </span>&#123;</span><br><span class="line">    <span class="comment">//入口方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(UserCrawlerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * id生成器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IdWorker <span class="title">idWorker</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> IdWorker(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//注入Redis主机地址</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;redis.host&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String redis_host;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义RedisScheduler的Bean</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisScheduler <span class="title">redisScheduler</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RedisScheduler(redis_host);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（4）实体类及数据访问接口</p>
<p>参见用户微服务。代码略</p>
<h3 id="4-2-2-爬取类"><a href="#4-2-2-爬取类" class="headerlink" title="4.2.2 爬取类"></a>4.2.2 爬取类</h3><p>com.tensquare.usercrawler.processor.UserProcessor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tensquare.usercrawler.processor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Page;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Site;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.processor.PageProcessor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章爬取处理类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserProcessor</span> <span class="keyword">implements</span> <span class="title">PageProcessor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//目标地址</span></span><br><span class="line">        page.addTargetRequests(page.getHtml().links()</span><br><span class="line">                .regex(<span class="string">"https://blog.csdn.net/[a-z 0-9 - _]+/article/details/[0-9]&#123;8&#125;"</span>)</span><br><span class="line">                .all());</span><br><span class="line">        <span class="comment">//设置xpath</span></span><br><span class="line">        <span class="comment">//昵称</span></span><br><span class="line">        String nickname= page.getHtml().xpath(<span class="string">"//*[@id=\"uid\"]/text()"</span>).toString();</span><br><span class="line">        <span class="comment">//图片地址（css选择器）</span></span><br><span class="line">        String image= page.getHtml().xpath(<span class="string">"//*[@id=\"asideProfile\"]/div[1]/div[1]/a"</span>).css(<span class="string">"img"</span>,<span class="string">"src"</span>).toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//打印获取页面需要的内容</span></span><br><span class="line">        System.out.println(<span class="string">"昵称："</span>+nickname);</span><br><span class="line">        System.out.println(<span class="string">"头像："</span>+image);</span><br><span class="line">        <span class="comment">//判断，如果有昵称和头像</span></span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.isEmpty(nickname)&amp;&amp;!StringUtils.isEmpty(image))&#123;</span><br><span class="line">            <span class="comment">//必须同时有昵称和头像</span></span><br><span class="line">            page.putField(<span class="string">"nickname"</span>,nickname);</span><br><span class="line">            page.putField(<span class="string">"image"</span>,image);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//否则，跳过采集</span></span><br><span class="line">            page.setSkip(<span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Site <span class="title">getSite</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Site.me().setSleepTime(<span class="number">3000</span>).setRetryTimes(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>提示：</p>
<p>注意css选择器的使用。</p>
<h3 id="4-2-3-下载工具类"><a href="#4-2-3-下载工具类" class="headerlink" title="4.2.3 下载工具类"></a>4.2.3 下载工具类</h3><p>资源提供了工具类，拷贝至tensquare_common工程的util包下</p>
<p>utils.DownloadUtil</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLConnection;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 下载工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadUtil</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下载</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> urlStr 下载地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filename 保存的文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> savePath 保存的路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">download</span><span class="params">(String urlStr, String filename, String savePath)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        URL url = <span class="keyword">new</span> URL(urlStr);</span><br><span class="line">        <span class="comment">//打开url连接</span></span><br><span class="line">        URLConnection connection = url.openConnection();</span><br><span class="line">        <span class="comment">//请求超时时间</span></span><br><span class="line">        connection.setConnectTimeout(<span class="number">5000</span>);</span><br><span class="line">        <span class="comment">//输入流</span></span><br><span class="line">        InputStream in = connection.getInputStream();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//文件</span></span><br><span class="line">        File file = <span class="keyword">new</span> File(savePath);</span><br><span class="line">        <span class="keyword">if</span> (!file.exists())</span><br><span class="line">            file.mkdirs();</span><br><span class="line">        OutputStream out = <span class="keyword">new</span> FileOutputStream(file.getPath() + <span class="string">"\\"</span> + filename);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//缓冲数据</span></span><br><span class="line">        <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="comment">//数据长度</span></span><br><span class="line">        <span class="keyword">int</span> len;</span><br><span class="line">        <span class="comment">//先读到bytes中</span></span><br><span class="line">        <span class="keyword">while</span> ((len = in.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">//再从bytes中写入文件</span></span><br><span class="line">            out.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//关闭IO</span></span><br><span class="line">        out.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-4-入库类"><a href="#4-2-4-入库类" class="headerlink" title="4.2.4 入库类"></a>4.2.4 入库类</h3><p>com.tensquare.usercrawler.pipeline.UserDbPipeline</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tensquare.usercrawler.pipeline;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.tensquare.usercrawler.dao.UserRepository;</span><br><span class="line"><span class="keyword">import</span> com.tensquare.usercrawler.po.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.ResultItems;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Task;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.pipeline.Pipeline;</span><br><span class="line"><span class="keyword">import</span> utils.DownloadUtil;</span><br><span class="line"><span class="keyword">import</span> utils.IdWorker;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 入库类，用于持久化数据到目标位置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDbPipeline</span> <span class="keyword">implements</span> <span class="title">Pipeline</span> </span>&#123;</span><br><span class="line">    <span class="comment">//注入dao</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line">    <span class="comment">//注入id生成器</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IdWorker idWorker;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注入图片文件路径</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;file.savepath&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String savePath;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//频道ID</span></span><br><span class="line">    <span class="keyword">private</span> String channelId;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setChannelId</span><span class="params">(String channelId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.channelId = channelId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(ResultItems resultItems, Task task)</span> </span>&#123;</span><br><span class="line">        String nickname = resultItems.get(<span class="string">"nickname"</span>);</span><br><span class="line">        String image= resultItems.get(<span class="string">"image"</span>);</span><br><span class="line"><span class="comment">//        System.out.println("nickname:"+nickname+",image:"+image);</span></span><br><span class="line">        <span class="comment">//--------数据库的保存</span></span><br><span class="line">        <span class="comment">//创建用户对象</span></span><br><span class="line">        User user=<span class="keyword">new</span> User();</span><br><span class="line">        <span class="comment">//id</span></span><br><span class="line">        user.setId(idWorker.nextId()+<span class="string">""</span>);</span><br><span class="line">        <span class="comment">//昵称</span></span><br><span class="line">        user.setNickname(nickname);</span><br><span class="line">        <span class="comment">//得到url的文件名的部分</span></span><br><span class="line">        String avatar=image.substring(image.lastIndexOf(<span class="string">"/"</span>)+<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//头像</span></span><br><span class="line">        user.setAvatar(avatar);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//数据库保存</span></span><br><span class="line">        userRepository.save(user);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//--------图片文件的保存</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//下载图片到本地</span></span><br><span class="line">            DownloadUtil.download(image,avatar,savePath);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在application.yml中添加文件的保存路径配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file:</span><br><span class="line">  savepath: D:\shhm031\data\images</span><br></pre></td></tr></table></figure>
<h3 id="4-2-5-任务类"><a href="#4-2-5-任务类" class="headerlink" title="4.2.5 任务类"></a>4.2.5 任务类</h3><p>com.tensquare.usercrawler.task.UserTask</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tensquare.usercrawler.task;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.tensquare.usercrawler.pipeline.UserDbPipeline;</span><br><span class="line"><span class="keyword">import</span> com.tensquare.usercrawler.processor.UserProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.Spider;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.pipeline.ConsolePipeline;</span><br><span class="line"><span class="keyword">import</span> us.codecraft.webmagic.scheduler.RedisScheduler;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户抓取的任务调度类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserTask</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注入ArticleProcessor</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserProcessor userProcessor;</span><br><span class="line">    <span class="comment">//注入文章pipeline</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDbPipeline userDbPipeline;</span><br><span class="line">    <span class="comment">//注入RedisScheduler</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisScheduler redisScheduler;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 抓取AI频道的文章数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="comment">//    @Scheduled(cron = "0 0 0 * * ?")//每天0点0分0秒执行一次</span></span><br><span class="line">    <span class="meta">@Scheduled</span>(cron = <span class="string">"* * 0/1 * * ?"</span>)<span class="comment">//每间隔一个小时执行一次</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">userTask</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始爬取用户信息......"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//蜘蛛</span></span><br><span class="line">        Spider.create(userProcessor)</span><br><span class="line">                <span class="comment">//添加种子url</span></span><br><span class="line">                .addUrl(<span class="string">"https://blog.csdn.net"</span>)</span><br><span class="line">                <span class="comment">//添加输出管道到控制台</span></span><br><span class="line">                .addPipeline(<span class="keyword">new</span> ConsolePipeline())</span><br><span class="line">                <span class="comment">//添加输出管道到数据库</span></span><br><span class="line">                .addPipeline(userDbPipeline)</span><br><span class="line">                <span class="comment">//设置Scheduler</span></span><br><span class="line">                .setScheduler(redisScheduler)</span><br><span class="line">                <span class="comment">//异步执行，效率更高</span></span><br><span class="line">                .start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>【扩展问题】</p>
<p>抓取的用户会重复，可手动做逻辑判断，如将昵称放到redis中，判断昵称是否存在。</p>
<p>文件名最好重新随机生成。</p>
<h1 id="附录-A-XPath语法"><a href="#附录-A-XPath语法" class="headerlink" title="附录 A XPath语法"></a>附录 A XPath语法</h1><h2 id="（1）选取节点："><a href="#（1）选取节点：" class="headerlink" title="（1）选取节点："></a>（1）选取节点：</h2><table>
<thead>
<tr>
<th>表达式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>nodename</td>
<td>选取此节点的所有子节点。</td>
</tr>
<tr>
<td>/</td>
<td>从根节点选取。</td>
</tr>
<tr>
<td>//</td>
<td>从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置。</td>
</tr>
<tr>
<td>.</td>
<td>选取当前节点。</td>
</tr>
<tr>
<td>..</td>
<td>选取当前节点的父节点。</td>
</tr>
<tr>
<td>@</td>
<td>选取属性。</td>
</tr>
</tbody>
</table>
<h2 id="（2）谓语"><a href="#（2）谓语" class="headerlink" title="（2）谓语"></a>（2）谓语</h2><p>谓语用来查找某个特定的节点或者包含某个指定的值的节点。（用来筛选节点）</p>
<p>谓语被嵌在方括号中。</p>
<table>
<thead>
<tr>
<th>表达式</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>/bookstore/book[1]</td>
<td>选取属于 bookstore 子元素的第一个 book 元素</td>
</tr>
<tr>
<td>/bookstore/book[last()]</td>
<td>选取属于 bookstore 子元素的最后一个 book元素</td>
</tr>
<tr>
<td>/bookstore/book[last()-1]</td>
<td>选取属于 bookstore 子元素的倒数第二个book 元素。</td>
</tr>
<tr>
<td>/bookstore/book[position()&lt;3]</td>
<td>选取最前面的两个属于 bookstore 元素的子元素的 book 元素。</td>
</tr>
<tr>
<td>//title[@lang]</td>
<td>选取所有拥有名为 lang 的属性的 title 元素。</td>
</tr>
<tr>
<td>//title[@lang=’eng’]</td>
<td>选取所有 title 元素，且这些元素拥有值为 eng的 lang 属性。</td>
</tr>
<tr>
<td>/bookstore/book[price&gt;35.00]</td>
<td>选取 bookstore 元素的所有 book 元素，且其中的 price 元素的值须大于 35.00。</td>
</tr>
<tr>
<td>/bookstore/book[price&gt;35.00]/title</td>
<td>选取 bookstore 元素中的 book 元素的所有title 元素，且其中的 price 元素的值须大于35.00。</td>
</tr>
</tbody>
</table>
<h2 id="（3）通配符"><a href="#（3）通配符" class="headerlink" title="（3）通配符"></a>（3）通配符</h2><p>XPath 通配符可用来选取未知的 XML 元素,通配指定节点。</p>
<table>
<thead>
<tr>
<th>表达式</th>
<th>描述</th>
<th>用法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>*</td>
<td>匹配任何元素节点</td>
<td>xpath（/div/*）</td>
<td>选取div下的所有子节点</td>
</tr>
<tr>
<td>@*</td>
<td>匹配任何属性节点</td>
<td>xpath(/div[@*])</td>
<td>选取所有带属性的div节点</td>
</tr>
<tr>
<td>node()</td>
<td>匹配任何类型的节点</td>
<td>xpath(//div[@class=’tb_cls’]).node()</td>
<td>选择标签为div且类属性为tb_cls的所有标签</td>
</tr>
</tbody>
</table>
<h2 id="（4）多路径选择"><a href="#（4）多路径选择" class="headerlink" title="（4）多路径选择"></a>（4）多路径选择</h2><p>通过在路径表达式中使用“|”运算符，您可以选取若干个路径。**</p>
<table>
<thead>
<tr>
<th>用法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>xpath（//book/title*&#124;*//book/price）</td>
<td>选取 book 元素的所有 title 和 price 元素。</td>
</tr>
<tr>
<td>xpath（//title&#124;//price）</td>
<td>选取文档中的所有 title 和 price 元素</td>
</tr>
</tbody>
</table>
<h2 id="（5）XPath-轴"><a href="#（5）XPath-轴" class="headerlink" title="（5）XPath 轴"></a>（5）XPath 轴</h2><p>轴可定义相对于当前节点的节点集。（路径轴-族谱）</p>
<table>
<thead>
<tr>
<th>表达式</th>
<th>描述</th>
<th>用法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ancestor</td>
<td>选取当前节点的所有先辈（父、祖父等）</td>
<td>xpath(//div[@id=’123’]/ancestor::*)</td>
<td>选择标签为div且ID号为123的所有先辈标签</td>
</tr>
<tr>
<td>ancestor-or-self</td>
<td>选取当前节点的所有先辈（父、祖父等）以及当前节点本身</td>
<td>xpath(//div[@id=’123’]/ancestor-or-self::*)</td>
<td>选择标签为div且ID号为123的所有先辈标签且包含自己</td>
</tr>
<tr>
<td>attribute</td>
<td>选取当前节点的所有属性</td>
<td>xpath(//div[@id=’123’]/attribute::class)</td>
<td>选择标签为div且ID号为123的类属性名称</td>
</tr>
<tr>
<td>child</td>
<td>选取当前节点的所有子元素</td>
<td>xpath(//div[@id=’123’]/child::book)</td>
<td>选择标签为div且ID号为123的所有子元素的为book节点</td>
</tr>
<tr>
<td>descendant</td>
<td>选取当前节点的所有后代元素（子、孙等）</td>
<td>xpath(./descendant::*)</td>
<td>返回当前节点的所有后代节点（子节点、孙节点）</td>
</tr>
<tr>
<td>following</td>
<td>选取文档中当前节点结束标签后的所有节点</td>
<td>xpath(./following::*)</td>
<td>选取文档中当前节点结束标签后的所有节点</td>
</tr>
<tr>
<td>parent</td>
<td>选取当前节点的父节点</td>
<td>xpath(./parent::*)</td>
<td>选取当前节点的父节点</td>
</tr>
<tr>
<td>preceding</td>
<td>选取文档中当前节点的开始标签之前的所有节点</td>
<td>xpath(//div[@id=’123’]/preceding::*)</td>
<td>选择标签为div且ID号为123的开始标签之前的所有节点</td>
</tr>
<tr>
<td>preceding-sibling</td>
<td>选取当前节点之前的所有同级节点</td>
<td>xpath(//div[@id=’123’]/preceding-sibling::*)</td>
<td>选择标签为div且ID号为123的之前的所有同级节点</td>
</tr>
<tr>
<td>self</td>
<td>选取当前节点</td>
<td>xpath(./self::*)</td>
<td>选取当前节点</td>
</tr>
</tbody>
</table>
<h2 id="（6）XPath-运算符"><a href="#（6）XPath-运算符" class="headerlink" title="（6）XPath 运算符"></a>（6）XPath 运算符</h2><table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
<th>实例</th>
<th>返回值</th>
</tr>
</thead>
<tbody>
<tr>
<td>\</td>
<td></td>
<td>计算两个节点集</td>
<td>//book \</td>
<td>//cd</td>
<td>返回所有拥有 book 和 cd 元素的节点集</td>
</tr>
<tr>
<td>+</td>
<td>加法</td>
<td>6 + 4</td>
<td>10</td>
</tr>
<tr>
<td>-</td>
<td>减法</td>
<td>6 - 4</td>
<td>2</td>
</tr>
<tr>
<td>*</td>
<td>乘法</td>
<td>6 * 4</td>
<td>24</td>
</tr>
<tr>
<td>div</td>
<td>除法</td>
<td>8 div 4</td>
<td>2</td>
</tr>
<tr>
<td>=</td>
<td>等于</td>
<td>price=9.80</td>
<td>如果 price 是 9.80，则返回 true。如果 price 是 9.90，则返回 false。</td>
</tr>
<tr>
<td>!=</td>
<td>不等于</td>
<td>price!=9.80</td>
<td>如果 price 是 9.90，则返回 true。如果 price 是 9.80，则返回 false。</td>
</tr>
<tr>
<td>&lt;</td>
<td>小于</td>
<td>price&lt;9.80</td>
<td>如果 price 是 9.00，则返回 true。如果 price 是 9.90，则返回 false。</td>
</tr>
<tr>
<td>&lt;=</td>
<td>小于或等于</td>
<td>price&lt;=9.80</td>
<td>如果 price 是 9.00，则返回 true。如果 price 是 9.90，则返回 false。</td>
</tr>
<tr>
<td>&gt;</td>
<td>大于</td>
<td>price&gt;9.80</td>
<td>如果 price 是 9.90，则返回 true。如果 price 是 9.80，则返回 false。</td>
</tr>
<tr>
<td>&gt;=</td>
<td>大于或等于</td>
<td>price&gt;=9.80</td>
<td>如果 price 是 9.90，则返回 true。如果 price 是 9.70，则返回 false。</td>
</tr>
<tr>
<td>or</td>
<td>或</td>
<td>price=9.80 or price=9.70</td>
<td>如果 price 是 9.80，则返回 true。如果 price 是 9.50，则返回 false。</td>
</tr>
<tr>
<td>and</td>
<td>与</td>
<td>price&gt;9.00 and price&lt;9.90</td>
<td>如果 price 是 9.80，则返回 true。如果 price 是 8.50，则返回 false。</td>
</tr>
<tr>
<td>mod</td>
<td>计算除法的余数</td>
<td>5 mod 2</td>
<td>1</td>
</tr>
</tbody>
</table>
<h2 id="（7）常用的功能函数"><a href="#（7）常用的功能函数" class="headerlink" title="（7）常用的功能函数"></a>（7）常用的功能函数</h2><p>使用功能函数能够更好的进行模糊搜索</p>
<table>
<thead>
<tr>
<th>表达式</th>
<th>描述</th>
<th>用法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>———–</td>
<td>—————————</td>
<td>——————————————————–</td>
<td>—————————</td>
</tr>
<tr>
<td>———–</td>
<td>—————————</td>
<td>——————————————————–</td>
<td>—————————</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>\</td>
<td>starts-with \</td>
<td>选取id值以ma开</td>
</tr>
</tbody>
</table>
<p>头的div节点   | xpath(‘//div[starts-with(@id,”ma”)]‘)                    | 选取id值以ma开头的div节点   | |<br>| contains | 选取id值包含ma的div节点 | xpath(‘//div[contains(@id,”ma”)]‘) | 选取id值包含ma的div节点 |<br>| ——– | ———————– | ———————————- | ———————– |<br>|          |                         |                                    |                         |<br>| and  | 选取id值包含ma和in的div节点 | xpath(‘//div[contains(@id,”ma”)and contains(@id,”in”)]‘) | 选取id值包含ma和in的div节点 |<br>| —- | ————————— | ——————————————————– | ————————— |<br>|      |                             |                                                          |                             |<br>| text() | 选取节点文本包含ma的div节点 | xpath(‘//div[contains(text(),”ma”)]‘) | 选取节点文本包含ma的div节点 |<br>| —— | ————————— | ————————————- | ————————— |<br>|        |                             |                                       |                             |</p>
<h2 id="基本学习用例参考"><a href="#基本学习用例参考" class="headerlink" title="基本学习用例参考"></a>基本学习用例参考</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bookstore</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">book</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span> <span class="attr">lang</span>=<span class="string">""</span>&gt;</span>红楼梦<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">price</span>&gt;</span>30<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">book</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">book</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>三国演义<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">price</span>&gt;</span>50<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">book</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">book</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span> <span class="attr">lang</span>=<span class="string">"eng"</span>&gt;</span>微服务编程<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">price</span>&gt;</span>100<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">book</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">book</span>&gt;</span><span class="tag">&lt;/<span class="name">book</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">book</span>&gt;</span><span class="tag">&lt;/<span class="name">book</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bookstore</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><h2 id="课程总结"><a href="#课程总结" class="headerlink" title="课程总结"></a>课程总结</h2><h2 id="面试问题"><a href="#面试问题" class="headerlink" title="面试问题"></a>面试问题</h2>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/04/11/hello-world/" rel="next" title="Hello World">
                <i class="fa fa-chevron-left"></i> Hello World
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Viviand0sin</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#网络爬虫框架Webmagic"><span class="nav-number">1.</span> <span class="nav-text">网络爬虫框架Webmagic</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-谈谈网络爬虫"><span class="nav-number">2.</span> <span class="nav-text">1 谈谈网络爬虫</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-什么是网络爬虫"><span class="nav-number">2.1.</span> <span class="nav-text">1.1 什么是网络爬虫</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-网络爬虫可以做什么"><span class="nav-number">2.2.</span> <span class="nav-text">1.2 网络爬虫可以做什么</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-网络爬虫常用的技术（Java）"><span class="nav-number">2.3.</span> <span class="nav-text">1.3 网络爬虫常用的技术（Java）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-1-底层实现-HttpClient-Jsoup"><span class="nav-number">2.3.1.</span> <span class="nav-text">1.3.1 底层实现 HttpClient + Jsoup</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-2-开源框架-WebMagic"><span class="nav-number">2.3.2.</span> <span class="nav-text">1.3.2 开源框架 WebMagic</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-爬虫框架WebMagic"><span class="nav-number">3.</span> <span class="nav-text">2 爬虫框架WebMagic</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-架构解析"><span class="nav-number">3.1.</span> <span class="nav-text">2.1 架构解析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-PageProcessor"><span class="nav-number">3.2.</span> <span class="nav-text">2.2 PageProcessor</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1-爬取页面全部内容"><span class="nav-number">3.2.1.</span> <span class="nav-text">2.2.1 爬取页面全部内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-2-爬取指定内容（XPath）"><span class="nav-number">3.2.2.</span> <span class="nav-text">2.2.2 爬取指定内容（XPath）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-3-添加目标地址抓取所有链接"><span class="nav-number">3.2.3.</span> <span class="nav-text">2.2.3 添加目标地址抓取所有链接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-4-目标地址正则匹配并只抓取指定内容"><span class="nav-number">3.2.4.</span> <span class="nav-text">2.2.4 目标地址正则匹配并只抓取指定内容</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-Pipeline"><span class="nav-number">3.3.</span> <span class="nav-text">2.3 Pipeline</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-1-ConsolePipeline-控制台输出"><span class="nav-number">3.3.1.</span> <span class="nav-text">2.3.1 ConsolePipeline 控制台输出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-2-FilePipeline-文件保存"><span class="nav-number">3.3.2.</span> <span class="nav-text">2.3.2 FilePipeline 文件保存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-3-JsonFilePipeline"><span class="nav-number">3.3.3.</span> <span class="nav-text">2.3.3 JsonFilePipeline</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-4-Pipeline的定制"><span class="nav-number">3.3.4.</span> <span class="nav-text">2.3.4 Pipeline的定制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-Scheduler"><span class="nav-number">3.4.</span> <span class="nav-text">2.4 Scheduler</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-1-内存队列"><span class="nav-number">3.4.1.</span> <span class="nav-text">2.4.1 内存队列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-2-文件缓存队列"><span class="nav-number">3.4.2.</span> <span class="nav-text">2.4.2 文件缓存队列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-3-Redis队列"><span class="nav-number">3.4.3.</span> <span class="nav-text">2.4.3 Redis队列</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-十次方文章爬取"><span class="nav-number">4.</span> <span class="nav-text">3 十次方文章爬取</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-需求分析"><span class="nav-number">4.1.</span> <span class="nav-text">3.1 需求分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-频道设置"><span class="nav-number">4.2.</span> <span class="nav-text">3.2 频道设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-代码编写"><span class="nav-number">4.3.</span> <span class="nav-text">3.3 代码编写</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-1-模块搭建"><span class="nav-number">4.3.1.</span> <span class="nav-text">3.3.1 模块搭建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-2-爬取处理类"><span class="nav-number">4.3.2.</span> <span class="nav-text">3.3.2 爬取处理类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-3-入库输出类"><span class="nav-number">4.3.3.</span> <span class="nav-text">3.3.3 入库输出类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-4-任务调度类"><span class="nav-number">4.3.4.</span> <span class="nav-text">3.3.4 任务调度类</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-十次方用户数据爬取"><span class="nav-number">5.</span> <span class="nav-text">4 十次方用户数据爬取</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-需求分析"><span class="nav-number">5.1.</span> <span class="nav-text">4.1 需求分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-代码编写"><span class="nav-number">5.2.</span> <span class="nav-text">4.2 代码编写</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-1-模块搭建"><span class="nav-number">5.2.1.</span> <span class="nav-text">4.2.1 模块搭建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-2-爬取类"><span class="nav-number">5.2.2.</span> <span class="nav-text">4.2.2 爬取类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-3-下载工具类"><span class="nav-number">5.2.3.</span> <span class="nav-text">4.2.3 下载工具类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-4-入库类"><span class="nav-number">5.2.4.</span> <span class="nav-text">4.2.4 入库类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-5-任务类"><span class="nav-number">5.2.5.</span> <span class="nav-text">4.2.5 任务类</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#附录-A-XPath语法"><span class="nav-number">6.</span> <span class="nav-text">附录 A XPath语法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#（1）选取节点："><span class="nav-number">6.1.</span> <span class="nav-text">（1）选取节点：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#（2）谓语"><span class="nav-number">6.2.</span> <span class="nav-text">（2）谓语</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#（3）通配符"><span class="nav-number">6.3.</span> <span class="nav-text">（3）通配符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#（4）多路径选择"><span class="nav-number">6.4.</span> <span class="nav-text">（4）多路径选择</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#（5）XPath-轴"><span class="nav-number">6.5.</span> <span class="nav-text">（5）XPath 轴</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#（6）XPath-运算符"><span class="nav-number">6.6.</span> <span class="nav-text">（6）XPath 运算符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#（7）常用的功能函数"><span class="nav-number">6.7.</span> <span class="nav-text">（7）常用的功能函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基本学习用例参考"><span class="nav-number">6.8.</span> <span class="nav-text">基本学习用例参考</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#总结"><span class="nav-number">7.</span> <span class="nav-text">总结</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#课程总结"><span class="nav-number">7.1.</span> <span class="nav-text">课程总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#面试问题"><span class="nav-number">7.2.</span> <span class="nav-text">面试问题</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Viviand0sin</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
